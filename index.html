<!DOCTYPE html>
<title>Casualwriter</title>

<link  href="md-document.css" rel="stylesheet">
<script src="md-document.js"></script>

<body onload="loadMdFile( location.href.split('?file=')[1]||'index.md', '<b>Home</b>' )">

<div id=header style="background:#58b;">

  <span id=title>casualwriter.github.io</span>

  <span id=menu style="float:right; padding:12px">
    <button onclick="loadMdFile( location.href.split('?file=')[1]||'index.md', this.innerText )">Home</button>
    <a href="./blog">Blog</a>
    <a href="./powerpage">Powerpage</a>
    <button disabled>Campo</button> 
    <button disabled>Misc</button> 
    <button onclick="window.print()">Print</button> 
    <button style="display:none" onclick="toggleHTML()" accesskey=s>ShowHTML</button> 
  </span>
</div>

<div id=content>
  <div id="left-panel" style=""></div>
  <div id="right-panel" style=""></div>
</div>

</body>
</html>

<script>
//######################################################################################
// Program: Show document by markdown (for powerpage documentation, may run directly via CDN)  
// Author: CK Hung
// Github: https://github.com/casualwriter/powerpage-md-document
//
// This program may run directly via CDN service
//
//   github-page: https://casualwriter.github.io/
//   Raw Doc:     https://github.com/casualwriter/powerpage-md-document/source
//   RawGit:      https://ghcdn.rawgit.org/casualwriter/powerpage-md-document/main/source/index.html
//   gitHack:     https://raw.githack.com/casualwriter/powerpage-md-document/main/source/index.html
//
// Last updated on 2021/10/21, v0.66, minor fix on markdown parser, TOC
//######################################################################################

//=== toggle HTML in right-panel. (this is a hidden function for developer)
function toggleHTML() {
  var html = document.getElementById('right-panel').innerHTML
  
  if (html.substr(0,5)=='<xmp>') {
     document.getElementById('right-panel').innerHTML = html.substr(5, html.length-11)
  } else {
     document.getElementById('right-panel').innerHTML = '<xmp>' + html.replace(/xmp\>/g,'xmp&gt;') + '</xmp>' 
  }
}

//=== load and parser markdown file. 
function loadMdFile( fname, title ) {
  var xmlhttp = new XMLHttpRequest();
  
  xmlhttp.onload = function (e) {
    var xhr = new XMLHttpRequest(); 
    xhr.open( 'get', 'https://blog.campodesktop.com/action.php?a=gitpage&p='+location.href, true);
	  xhr.send();  
    document.getElementById('right-panel').innerHTML =  simpleMarkdown(this.responseText) + '<br>'
    simpleTOC( 'right-panel', 'left-panel', title||fname, 'color:red' )
    if (fname.indexOf('#')>0) location.href = fname.substr( fname.indexOf('#') ) 
  }
  
  xmlhttp.open("GET", fname , true)
  xmlhttp.send();
}

// log leave time at unload event
window.onbeforeunload = function() { 
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open( 'get', 'https://blog.campodesktop.com/action.php?a=leave&p='+location.href, true);
	xmlhttp.send(); 
};
</script>
