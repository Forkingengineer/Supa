<!DOCTYPE html>
<title>Casualwriter</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link  href="md-document.css" rel="stylesheet">
<script src="md-document.js"></script>

<body onload="loadMdFile( location.href.split('?file=')[1]||'index.v1.md', '<b>Home</b>' )">

<div id=header style="background:#0057b7;">

  <span id=title>casualwriter.github.io</span>

  <span id=menu style="float:right; padding:12px">
    <button onclick="loadMdFile( location.href.split('?file=')[1]||'index.md', this.innerText )">Home</button>
    <a href="./blog">Blog</a>
    <a href="./powerpage">Powerpage</a>
    <a href="./casual-markdown">Casual-Markdown</a> 
    <button disabled>Misc</button> 
    <button onclick="window.print()">Print</button> 
    <button style="display:none" onclick="toggleHTML()" accesskey=s>ShowHTML</button> 
  </span>
</div>

<div id=content>
  <div id="left-panel" style=""></div>
  <div id="right-panel" style=""></div>
</div>

</body>
</html>

<script>
//######################################################################################
// Program: Show document by markdown (for powerpage documentation, may run directly via CDN)  
// Author: CK Hung
// Github: https://github.com/casualwriter/powerpage-md-document
//
// This program may run directly via CDN service
//
//   github-page: https://casualwriter.github.io/
//   Raw Doc:     https://github.com/casualwriter/powerpage-md-document/source
//   RawGit:      https://ghcdn.rawgit.org/casualwriter/powerpage-md-document/main/source/index.html
//   gitHack:     https://raw.githack.com/casualwriter/powerpage-md-document/main/source/index.html
//
// Last updated on 2021/10/21, v0.66, minor fix on markdown parser, TOC
// Last updated on 2021/11/16, v0.67, support mobile. responsive css with touch support.
//######################################################################################

//=== toggle HTML in right-panel. (this is a hidden function for developer)
function toggleHTML() {
  var html = document.getElementById('right-panel').innerHTML
  
  if (html.substr(0,5)=='<xmp>') {
     document.getElementById('right-panel').innerHTML = html.substr(5, html.length-11)
  } else {
     document.getElementById('right-panel').innerHTML = '<xmp>' + html.replace(/xmp\>/g,'xmp&gt;') + '</xmp>' 
  }
}

//=== load and parser markdown file. 
function loadMdFile( fname, title ) {
  var xmlhttp = new XMLHttpRequest();
  
  xmlhttp.onload = function (e) {
    var xhr = new XMLHttpRequest(); 
    xhr.open( 'get', 'https://blog.campodesktop.com/action.php?a=gitpage&p='+location.href, true);
	  xhr.send();  
    document.getElementById('right-panel').innerHTML =  simpleMarkdown(this.responseText) + '<br>'
    document.getElementById('right-panel').scrollTop = 0
    simpleTOC( 'right-panel', 'left-panel', title||fname, 'color:red' )
    if (fname.indexOf('#')>0) location.href = fname.substr( fname.indexOf('#') ) 
  }
  
  xmlhttp.open("GET", fname , true)
  xmlhttp.send();
}

// touch event for mobile (swipe to show/hide right-panel)
if (window.innerWidth<900) {

  function toggleTOC(show) {
    var disp = document.getElementById('left-panel').style.display
    document.getElementById('left-panel').style.display = show||(disp=='none')? 'block' : 'none'
    document.getElementById('right-panel').style.display = show||(disp=='none')? 'none' : 'block' 
  }
  
  window.addEventListener( 'touchstart', function(e) { document.touch=e.changedTouches[0] } )
  
  window.addEventListener( 'touchend', function(e) { 
  	 var distX = e.changedTouches[0].clientX - document.touch.clientX
  	 var distY = e.changedTouches[0].clientY - document.touch.clientY
  	 if ( Math.abs(distY) < 15 && distX > 30 ) {
  			e.preventDefault(); 
        toggleTOC(true)
  	 } else if ( Math.abs(distY) < 15 && distX < -20 ) {
  			e.preventDefault(); 
        toggleTOC(false) 
  	 }
    } );
    
    document.getElementById('left-panel').onclick = function() {toggleTOC(false)}
    document.getElementById('title').onclick = function() {toggleTOC()} 
}

</script>
